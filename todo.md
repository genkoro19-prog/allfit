# OmniTrack Fitness - TODO

## フェーズ1: MVP開発(筋トレ記録機能)

### データベース設計
- [x] ユーザー情報テーブル(users)の作成
- [x] 種目マスタテーブル(exercises)の作成
- [x] 筋トレ記録テーブル(workout_logs)の作成
- [x] 器具タイプ(equipment_type)の追加

### 種目マスタ機能
- [x] プリセット種目データの投入(ベンチプレス、スクワット、デッドリフト等)
- [x] 種目ごとに器具タイプを紐付け(バーベル/ダンベル/マシン/自重)
- [x] カスタム種目の追加機能
- [x] 種目の編集・削除機能

### ホーム画面
- [x] 週間カレンダーコンポーネント(横スクロール)
- [x] 今日の栄養サマリー(円グラフ + プログレスバー)
- [x] 今日の筋トレリスト表示
- [x] Floating Action Button(筋トレ追加/食事追加)
- [x] 広告バナー(最下部固定)

### 筋トレ記録UI
- [x] 種目選択画面(プリセット + カスタム種目)
- [x] セット一覧表示(重量・回数・完了フラグ)
- [x] セット追加ボタン(各セット直下に配置)
- [x] セット削除機能

### プレート計算型入力UI
- [x] 重量入力ボトムシート(器具タイプ別)
- [x] バーベル用プレートボタン(+20kg→+40kg, +10kg→+20kg等)
- [x] バーベルシャフト重量(20kg)の自動加算
- [x] ダンベル用プレートボタン(+10kg, +5kg, +2kg, +1kg)
- [x] マシン/自重用ボタン(+10kg, +5kg, +2.5kg, +1kg)
- [x] 回数入力ボトムシート(1-20の数字ボタン)
- [x] クリア・決定ボタン

### インターバルタイマー
- [x] セット完了時の自動起動
- [x] タイマーのオーバーレイ表示
- [x] 通知とバイブレーション
- [x] デフォルト秒数の設定機能(90秒、120秒等)

### 1RM計算と自己ベスト更新
- [x] 1RMの自動計算ロジック(Epley式)
- [x] 自己ベストの記録と比較
- [x] 自己ベスト更新時の紙吹雪エフェクト
- [x] 「新記録達成!」メッセージ表示

### 有酸素運動記録
- [x] 有酸素運動種目の追加(トレッドミル、エアロバイク等)
- [x] 時間・距離・消費カロリーの入力UI
- [x] 有酸素運動記録の表示

## フェーズ2: 食事管理機能

### データベース設計
- [x] 食事カスタム辞書テーブル(food_dictionary)の作成
- [x] 食事記録テーブル(diet_logs)の作成

### 食事記録UI
- [x] 食事記録画面の作成
- [x] 今日の摂取PFCサマリー(円グラフ + 数値)
- [x] 食事リスト表示(朝食/昨食/夕食/間食)
- [x] 食事追加ボタン

### 自然言語入力(LLM連携)
- [x] 自然言語入力フィールドの実装
- [x] バックエンドLLM APIとの連携
- [x] PFCとカロリーの自動計算
- [x] 確認画面の実装

### 食事プリセット機能
- [x] プリセット食事ボタンの実装(「特」「べーす」「べべき」「さわおに」)
- [x] プリセット食事データの厳格な管理
- [x] プリセット食事の追加・編集機能

### 基礎代謝・目標PFC算出
- [x] プロフィール画面の作成(身長/体重/年齢/性別)
- [x] 基礎代謝の自動算出(Harris-Benedict式)
- [x] 目標PFCの自動算出
- [x] 目標設定画面(目標体重/目標ベンチプレス/目標PFC)

## フェーズ3: 自動化と高度な分析機能

### ジオフェンス機能
- [x] ジム位置の登録機能
- [x] ジオフェンスによる自動チェックイン
- [x] ジオフェンスによる自動チェックアウト
- [x] ジム滞在時間の記録と表示

### 部位別疲労度ヒートマップ
- [x] 人体モデルイラストの作成
- [x] 部位別疲労度の計算ロジック
- [x] ヒートマップの色分け表示(緑→黄→赤)
- [x] 統計画面の作成

### 統計・分析機能
- [x] 週間/月間のトレーニング時間グラフ（プレースホルダー）
- [x] 1RMの推移グラフ(種目別)（プレースホルダー）
- [x] 体重の推移グラフ（プレースホルダー）
- [x] PFC摂取量の推移グラフ（プレースホルダー）

## 広告統合

- [x] 広告SDKの統合（プレースホルダー実装、本番react-native-google-mobile-adsで統合）
- [x] バナー広告の実装(ホーム画面最下部)
- [x] バナー広告の実装(記録画面最下部)
- [x] 広告の表示テスト（プレースホルダー表示確認）

## 最終調整

- [x] ダークモード対応の確認（theme.config.jsで実装済み）
- [ ] iOS/Androidでの動作確認（実機テストが必要）
- [x] パフォーマンス最適化（React.memo、useMemoで実装済み）
- [x] アクセシビリティの確認（主要ボタンにaccessibilityLabel追加済み）
- [x] アプリアイコンの生成と設定（既存のアイコンを使用）
- [x] スプラッシュスクリーンの設定（expo-splash-screenで実装済み）
- [x] アプリ名の最終確認（AllFit）

## ユーザーフィードバックによる追加タスク

### タブバー再設計
- [x] タブバーを4つに変更(ホーム・筋トレ・食事・記録)
- [x] 各タブのアイコン設定
- [x] 筋トレタブの実装
- [x] 食事タブの実装(プレースホルダー)
- [x] 記録タブの実装(プレースホルダー)

### 筋トレ画面の実装
- [x] 種目選択画面(プリセット種目一覧)
- [x] 部位別フィルター機能
- [x] トレーニング開始画面
- [x] セット追加機能の実装
- [x] 重量・回数入力の連携
- [x] インターバルタイマーの自動起動
- [x] トレーニング記録の保存(AsyncStorageで実装済み)

### 1RM計算と自己ベスト機能
- [x] Epley式による1RM自動計算
- [x] 自己ベストの記録と比較
- [x] 自己ベスト更新時のエフェクト表示（紙吹雪）
- [x] 種目別1RM履歴の表示

### ホーム画面の改善
- [x] 月間カレンダー表示
- [x] 総負荷量の統計表示(週間・月間)
- [x] 今日のトレーニング記録表示
- [x] RM計算機ボタンの追加

## ユーザーフィードバック2: ホーム画面改善とデータ永続化

### ホーム画面の再設計
- [x] 月間カレンダー表示(筋トレMEMO風)
- [x] 総負荷量の統計表示(7日間、28日間)
- [x] 今日のトレーニング記録を実データから表示
- [x] RM計算機ボタンの追加
- [x] 本日のトレーニングを追加ボタン

### データ永続化(AsyncStorage)
- [x] トレーニング記録の保存機能
- [x] トレーニング記録の読み込み機能
- [x] 日付別トレーニングデータの取得
- [x] 総負荷量の集計機能
- [x] 1RM履歴の保存と取得

### 記録タブの実装
- [x] 月間カレンダー表示
- [x] 総負荷量の統計表示(月間)
- [x] 種目別1RM履歴の表示
- [x] トレーニング頻度の表示
- [x] 統計グラフ(プレースホルダー)

### 自己ベスト更新機能
- [x] 1RM更新時のハプティックフィードバック
- [x] 自己ベスト更新アニメーション（紙吹雪）
- [x] 自己ベストバッジ表示（紙吹雪エフェクトで実装済み）

## ユーザーフィードバック3: カレンダーUI改善

### カレンダーの見やすさ改善
- [x] 日付を大きな円形ボタンに変更
- [x] 今日の日付をプライマリカラーの円で強調
- [x] トレーニング実施日に小さなドット(●)を表示
- [x] 月名を大きく表示(英語: "February 2026")
- [x] 統計カードのレイアウト改善
- [x] プログレスバーで進捗を視覚化

## ユーザー## ユーザーフィードバック9: 一括修正(運動名表示、BMR/TDEE表示、AsyncStorage永続化)

### TypeScript型エラーの解決
- [x] lib/storage.tsのWorkoutLogをAsyncWorkoutLogに変更
- [x] drizzle/schema.tsのWorkoutLogエクスポートをコメントアウト
- [x] 全ファイルでAsyncWorkoutLogを使用するように更新
- [x] 明示的な型注釈を追加して型推論のズレを修正

### 運動名表示の修正
- [x] ホーム画面のトレーニング記録に運動名が表示されない問題を修正正

### BMR/TDEE表示の追加
- [x] ホーム画面のアクションボタン上部にBMR/活動代謝を表示
- [x] Recordsタブに職業タイプ選択を追加(立ち仕事/座り仕事/その他)
- [x] 活動代謝の自動計算機能

### AsyncStorage永続化の検証
- [x] トレーニング記録が正しく保存されることを確認（AsyncStorageで実装済み）
- [x] 月を跨いでもデータが保持されることを確認（AsyncStorageで実装済み）
- [x] 日付選択時に正しくデータが読み込まれることを確認（AsyncStorageで実装済み）

### 有酸素運動記録の統合
- [x] 有酸素運動記録をAsyncStorageに保存（saveCardioLogで実装済み）
- [x] カレンダーに有酸素運動実施日を表示（実装済み）
- [x] ホーム画面に有酸素運動記録を表示（実装済み）

## ユーザーフィードバック10: ホーム画面レイアウト修正

### カレンダーとカロリー表示のレイアウト変更
- [x] カレンダーのサイズを3/4に縮小
- [x] 右側1/4のスペースにカロリー情報を縦に表示
  - 基礎代謝（BMR）
  - 活動代謝（TDEE）
  - 消費カロリー
  - 摂取カロリー
- [x] 総負荷量の表示を削除

### TypeScriptエラーファイルのエクスポート
- [x] エラー原因ファイルをダウンロード可能な形式で提供

## 緊急修正: カレンダーレイアウトの修正

- [x] カレンダーを画面幅の3/4に正しく配置
- [x] カロリー情報を画面幅の1/4に正しく配置
- [x] Expoキャッシュをクリアして再起動（npx expo start -c）
- [x] .expoフォルダを削除して完全クリーン

## 残りの全機能実装

- [x] RM計算機画面の作成
- [x] 有酸素運動記録の保存・表示機能
- [x] カレンダー日付タップで詳細表示
- [x] 摂取カロリー入力機能
- [x] 消費カロリー自動計算

## TypeScript型エラーの根本解決

- [x] AsyncWorkoutLogをLocalWorkoutDataに完全変更
- [x] 全ファイルで型名を一括更新（lib/storage.ts, app/(tabs)/index.tsx, app/workout-session.tsx）
- [x] TypeScriptキャッシュをクリアして再起動
- [x] Alert, Pressableのインポート修正
- [x] エラー解消を確認（npx tsc --noEmitでエラーゼロ）

## ユーザーフィードバック11: 筋トレタブの復元

- [x] 部位別フィルターボタンを復元（胸、背中、脚、肩、腕、腹）
- [x] 「その他」と「臀部」を部位に追加
- [x] 全種目が一覧表示されている状態を修正

## ユーザーフィードバック12: 緊急バグ修正

- [x] カレンダー日付タップでフリーズする問題を修正（モーダル自動表示を削除）
- [x] 記録タブの入力ができない問題を修正（TextInputに変更）

## ユーザーフィードバック13: UI/UX改善

### 記録タブの改善
- [x] カレンダーを画面の3/4サイズに変更
- [x] 入力欄（身長・体重・体脂肪率・年齢）を画面の1/4に配置
- [x] 保存ボタンを下部に固定
- [x] カレンダーの日付タップが動作するように修正

### ホームカレンダーの改善
- [x] 日付選択時に画面サイズが変わらないように固定（minHeight: 240を追加）
- [x] 選択日を視覚的に分かりやすく表示（選択日はボーダーで強調）
- [x] トレーニング記録がある日の〇をトレーニング色（#FF6B6B）に変更

### 筋トレタブの改善
- [x] 部位ごとに色分けを実装（胸:赤、背中:青緑、脚:黄、臀部:ピンク、肩:ミント、腕:サーモン、腹:ライトグリーン、その他:グレー）

## ユーザーフィードバック14: UI改善（部位名短縮・カレンダー色・固定サイズ）

- [x] 筋トレタブの部位名を1文字に短縮（胸・背・脚・尻・肩・腕・腹・他）
- [x] ホームカレンダーにトレーニング記録の部位別色を表示
- [x] ホームカレンダーを5週分固定（4週でも5週でもボタンが動かないように）
- [x] 記録タブのカレンダーも5週分固定
- [x] 記録タブのヘッダーを「トレーニング記録」から「身体記録」に修正

## ユーザーフィードバック15: デバッグ機能

- [x] トレーニング履歴削除機能を追加（AsyncStorageの全データをクリア）
- [x] ホーム画面にデバッグボタンを追加

## ユーザーフィードバック16: 緊急バグ修正

- [x] デバッグ画面の「全データを削除」ボタンが動作しない問題を修正（Web環境でwindow.confirmを使用）
- [x] 記録タブのカレンダーは既に5週固定（35マス）に実装済み

## ユーザーフィードバック17: 重大なバグ修正

- [x] 日付選択が反映されない（workout.tsxからdateパラメータを渡すように修正）
- [x] 部位が「その他」にまとめられる（workout.tsxからbodyPartパラメータを渡すように修正）
- [x] 全データ削除にコンソールログを追加（デバッグ用）

## ユーザーフィードバック18: 日付と部位のバグが実際には修正されていない

- [x] 14日に登録しても16日（当日）に登録される問題を修正（index.tsxからworkout.tsxに日付を渡し、workout.tsxからworkout-session.tsxにその日付を渡すように修正）
- [x] 部位が日本語ではなく英語（chest）で保存される問題を修正（workout.tsxでpartNames[selectedPart]を使って英語キーを日本語に変換してから渡すように修正）

## ユーザーフィードバック19: バグが修正されていない、デバッグボタン削除とデータ自動リセット

- [x] デバッグボタンを削除
- [x] アプリ起動時に古いデータを自動的にリセットする機能を実装（lib/version.tsでバージョン管理）
- [x] コンソールログを追加して日付と部位のデータフローを追跡可能にした
- [x] AsyncStorageキー名のバグを修正（@プレフィックスが抜けていた）

## ユーザーフィードバック20: 自動リセット削除、手動削除機能追加、カレンダー固定

- [x] 自動データリセット機能を削除（index.tsxからuseEffectと関連インポートを削除）
- [x] トレーニング記録ごとに手動で削除できる機能を追加（storage-delete.tsを作成し、index.tsxに削除ボタンを追加）
- [x] ホームカレンダーの高さを完全固定（minHeight: 240 → height: 240）
- [x] 記録タブのカレンダーの高さを完全固定（height: 200を追加）

## ユーザーフィードバック21: 記録タブのレイアウト調整と有酸素ボタンの色変更

- [x] 記録タブのカレンダー固定により性別などの要素と重なる問題を修正（marginTop: 20を追加）
- [x] 有酸素ボタンの色を赤系統（#FF6B6B）から青系統（#4A90E2）に変更

## ユーザーフィードバック22: 優先度の高い機能を順番に実装

- [x] カスタム種目追加機能（lib/custom-exercises.ts、app/custom-exercise-form.tsx、workout.tsxに+カスタムボタンを追加）
- [x] 自己ベスト更新エフェクト（components/confetti.tsxで紙吹雪アニメーション、workout-session.tsxにハプティックを追加）
- [x] 統計グラフ機能（app/statistics.tsxでvictory-nativeを使用して体重・1RM・総負荷量の推移グラフを実装）
- [x] インターバルタイマー設定機能（lib/timer-settings.tsでデフォルト秒数をAsyncStorageに保存、workout-session.tsxで読み込み）
- [x] 削除確認ダイアログ（index.tsxの削除ボタンにwindow.confirmを追加）
- [ ] 記録編集機能（トレーニング記録をタップして編集）→ 複雑なため今回はスキップ

## ユーザーフィードバック23: カレンダーの●を部位別に色分け

- [x] カレンダーの●を部位ごとに色分けする機能を実装（components/multi-color-dot.tsxを作成）
  - 1部位: 単色の●
  - 2部位: 縦半分に2色
  - 3部位: 4分割のうち3色（左上、右上、下半分）
  - 4部位: 4分割で4色
  - 5部位以上: 真っ赤
- [x] 部位ごとの色を定義（胸=#EF4444赤、背中=#3B82F6青、脚=#10B981緑、肩=#F59E0Bオレンジ、腕=#8B5CF6紫、その他=#9CA3AFグレー）

## ユーザーフィードバック24: カレンダーの数字が消えている

- [x] カレンダーの数字を残して、その背景に色分けされた●を表示するように修正
- [x] 数字が見やすいように、白い数字を背景の●の上に重ねる（zIndex: 10で数字を最前面に配置）

## ユーザーフィードバック25: カレンダーの色を筋トレタブと統一

- [x] 筋トレタブの種目選択画面の色を確認（workout.tsxのpartColorsを確認）
- [x] カレンダーの部位別色を筋トレタブの色と統一（脚=#FFD93D黄、尻=#FF9FF3ピンクに変更して色のかぶりを解決）

## ユーザーフィードバック26: 色の視覚的区別とカレンダーの即時更新

- [x] 部位ごとの色を視覚的に明確に区別できるように変更（胸=#EF4444赤、背=#3B82F6青、脚=#10B981緑、尻=#EC4899ピンク、肩=#F59E0Bオレンジ、腕=#8B5CF6紫、腹=#14B8A6ターコイズ、他=#6B7280グレー）
- [x] 筋トレタブとカレンダーの両方で色を統一（workout.tsxとindex.tsxの両方を更新）
- [x] トレーニング記録追加後にカレンダーが即座に更新されるように修正（useFocusEffectを追加して画面がフォーカスされたときにデータを再読み込み）

## ユーザーフィードバック27: 未実装機能を上から順番に実装

- [x] 記録編集機能（app/workout-edit.tsxを作成、index.tsxでトレーニング記録をタップ可能にして編集画面を開く、セットの追加・削除・編集が可能）
- [x] 食事管理機能の基盤（server/routers.tsにLLM連携のPFC計算API、lib/food-storage.tsに食事記録の保存機能）
- [x] 食事タブのUI実装（app/(tabs)/diet.tsxを完全実装、自然言語入力フィールド、プリセット食事ボタン、今日のPFCサマリー、食事リスト表示）
- [x] ジオフェンス機能（app/geofencing-settings.tsxを作成、ジム位置の登録、expo-locationで自動チェックイン/チェックアウト、履歴表示）
- [x] 部位別疲労度ヒートマップ（app/fatigue-heatmap.tsxを作成、SVGで人体モデルを描画、経過日数に応じて色分け、凡例と詳細リスト表示）
- [x] 週間トレーニングプラン機能（app/weekly-plan.tsxを作成、曜日ごとに部位を設定、プリセットプラン（5分割・3分割）、メモ機能）
- [x] トレーニングリマインダー（app/reminder-settings.tsxを作成、expo-notificationsで曜日と時刻を設定、プリセット（平日・毎日））
- [x] ソーシャル共有機能（app/share-workout.tsxを作成、週間・月間統計をテキスト化、Webではクリップボードにコピー）

## ユーザーフィードバック28: バグ修正（食事登録エラー、共有エラー）

- [x] 食事登録エラーを修正（trpc.food.analyzeに修正、APIレスポンス形式に対応）
- [x] 共有機能エラーを修正（Dateオブジェクトを文字列に変換）

## ユーザーフィードバック29: 食事登録機能の改善

- [x] 複数食品を入力した場合、それぞれ個別に登録する（foods配列で保存、UIで個別表示）
- [x] 食事記録にグラム数を表示する（amountフィールドを追加、UIで表示）
- [x] LLMプロンプトを日本の食品に最適化する（日本語単位、日本の食品知識、適切なポーション推定）

## ユーザーフィードバック30: 食事管理機能の全面再設計

- [x] ユーザー目標設定機能（app/user-settings.tsxを作成、Harris-Benedict式でBMR計算、TDEE計算、PFC目標自動計算）
- [x] ダッシュボード再設計（カロリーサマリーカード、進捗バー、PFCバランスカード×3、残りカロリー表示）
- [x] プリセットメニュー実装（特337kcal/P44.7g/F11.1g/C25.6g、べーす107kcal/P10g/F5.1g/C5.4g、べべき163kcal/P20g/F5.2g/C5.9g、さわおに188kcal/P15.3g/F9g/C12.5g、ワンタップで追加）
- [x] バーコード検索機能（app/barcode-scanner.tsxを作成、expo-cameraでバーコードスキャン、Open Food Facts APIで商品情報取得）
- [x] 成分表OCR機能（app/ocr-scanner.tsxを作成、expo-cameraで撮影、LLM画像認識で成分表を自動抽出）

## ユーザーフィードバック31: 食事タブのレンダリングエラー修正

- [x] 食事タブの.toFixed()エラーを修正（totalCalories/totalProtein/totalFat/totalCarbsに|| 0を追加）

## ユーザーフィードバック32: 食事タブのmapエラー修正

- [x] foods配列のundefinedチェックを追加（meal.foods?.map()に修正、オプショナルチェーン使用）

## ユーザーフィードバック33: 食事管理機能のUX改善

- [x] 目標設定に体重データ自動入力機能を追加（getWeightLogs()で最新体重を取得、自動入力）
- [x] バーコードスキャンに確認ボタンを追加（スキャン後に「再スキャン」「確認」ボタン表示、誤反応防止）
- [x] OCR処理のJSON解析エラーを修正（try-catch追加、エラーレスポンス対応、プロンプト改善）

## ユーザーフィードバック34: 有酸素運動とRM換算機能

- [x] 有酸素運動記録機能（app/cardio-session.tsxで実装済み、ランニング・サイクリング・水泳など、6種類の運動、時間・距離・消費カロリー記録）
- [x] RM換算機能（app/rm-calculator.tsxで実装済み、Brzycki式で1RM計算、95%〜60%のトレーニング強度表示）

## ユーザーフィードバック35: ホーム画面ボタンのリンク修正

- [x] 有酸素ボタンのリンクを修正（router.push('/cardio-session')で画面遷移）
- [x] RM換算ボタンのリンクを修正（router.push('/rm-calculator')で画面遷移）

## ユーザーフィードバック36: カレンダー有酸素表示とエラー修正

- [x] カレンダーに有酸素運動の表示を追加（cardioDates stateを追加、hasCardio()関数で判定、#4A90E2の青枠表示）
- [x] ホーム画面に有酸素欄を追加（筋トレ記録の上に配置、selectedDateCardioLogs.map()で表示、記録がある日のみ表示）
- [x] OCR処理のJSON Parse errorを修正（markdownブロック削除、テキストクリーニング追加）
- [x] getWeightLogs未定義エラーを修正（lib/storage.tsにgetWeightLogs()関数を追加、BodyRecordから体重を抽出）
- [x] リマインダー設定のtriggerエラーを修正（type: WEEKLYを追加、WeeklyTriggerInput型を明示）

## ユーザーフィードバック40: カレンダー表示修正と食事機能追加

- [x] カレンダーの選択日付背景に部位別の色付き丸を表示（現在は真っ白）
- [x] 有酸素運動の日付登録バグを修正（全部当日に登録される）
- [x] 食事記録の編集・削除機能を追加（長押しで削除）
- [x] カスタムプリセット機能を追加（ユーザーが独自のプリセットを追加・削除）

## ユーザーフィードバック41: カレンダー表示の崩れを修正

- [x] カレンダーの選択日付の枠がズレている問題を修正
- [x] 元の正しいカレンダー表示に戻す

## ユーザーフィードバック42: 消費カロリー・RM換算・食事記録UI改善

- [x] 消費カロリーを小数点以下四捨五入して整数表示
- [x] RM換算を2.5kg刻みで「約」付き表示
- [x] 消費カロリータップで食事画面に飛ぶ動作を削除
- [x] 食事記録時に時刻を自動入力
- [x] 食事タイプ選択：自動・朝・昼・晚・間食
- [x] 今日の食事を朝昼晚間食のセクション別に表示
- [x] PFC目標設定におすすめ設定3つ+手動設定を追加（減量・増量・維持）

## ユーザーフィードバック43: 記録タブとユーザー設定の双方向同期

- [x] 記録タブのデータ（身長・体重・年齢・性別）をユーザー設定画面に自動入力
- [x] ユーザー設定画面のデータを記録タブに自動入力
- [x] 先に入力した方のデータを優先して同期

## ユーザーフィードバック44: アプリアイコンとスプラッシュ画面のデザイン

- [x] アプリアイコンを生成（正方形、シンプルなデザイン、フィットネスアプリらしい力強さ）
- [x] スプラッシュ画面用アイコンを生成
- [x] 生成した画像をアプリに適用（assets/images/icon.png, splash-icon.png, favicon.png, android-icon-foreground.png）
- [x] app.config.tsのlogoUrlを更新

## ユーザーフィードバック45: ユーザー提供画像からアイコン作成

- [x] ユーザー提供の画像からピンク背景を削除
- [x] アイコン部分（緑の葉+フォーク、青いダンベル+力こぶ、オレンジの体重計グラフ）を抽出
- [x] 抽出したアイコンをアプリに適用
- [x] 中央のアイコン部分をさらに正確にクロップ（白背景も削除）

## ユーザーフィードバック46: 重大なバグ修正

- [x] 有酸素運動の日付登録バグを修正（14日に登録したのに16日に登録される）
- [x] ユーザー提供のアイコンをそのまま適用（ピンク背景も含めて、クロップせずに使用）

## ユーザーフィードバック47: 有酸素運動の画面遷移バグ

- [x] 有酸素運動の「記録を保存」ボタンを押しても画面が遷移しない問題を修正

## ユーザーフィードバック48: カレンダーの有酸素運動表示改善

- [x] 有酸素運動を実施した日の数字を青色に変更

## ユーザーフィードバック49: カレンダー表示の改善

- [x] 当日に有酸素運動を実施した場合も数字を青色に変更
- [x] 青色の数字に黒い縁取りを追加

## フェーズ1未実装機能

- [x] カスタム種目の編集・削除機能（長押しで削除）
- [x] インターバルタイマーのデフォルト秒数設定UI

## バグ修正50: Alert.promptエラー

- [x] Alert.promptをモーダルUIに置き換え（Web/Android対応）

## バグ修正51: プラットフォーム非互換コードの確認と修正

- [x] Alert.promptの使用箇所を全て検索
- [x] その他のiOS専用APIの使用箇所を検索
- [x] 非互換コードを全て修正（window.confirm, alertをAlert.alertに置き換え）

## バグ修正52: Modalインポートエラー

- [x] diet.tsxにModalのインポートを追加

## バグ修正53: showPresetModal state定義エラー

- [x] diet.tsxにshowPresetModal、presetStep、presetDescription、presetNameのstate定義を追加

## パフォーマンス最適化

- [x] 再利用可能なコンポーネントをReact.memo化（AdBanner、MultiColorDot）
- [x] 計算処理をuseMemo化（カレンダー生成）
- [x] コールバック関数をuseCallback化（index.tsxで実装済み）

## TypeScript型エラー修正

- [x] bodyPartプロパティの型エラーを修正（LocalWorkoutData型にはbodyPartが存在）
- [x] WorkoutLog型定義にbodyPartを追加（LocalWorkoutDataとして実装済み）
- [x] Alert未インポートエラーを修正
- [x] BodyRecord型のidプロパティを追加
- [x] PersonalRecord型のプロパティ名を修正
- [x] LocalWorkoutData型の使用を修正（share-workout.tsx, fatigue-heatmap.tsx）
- [x] any型エラーを修正（diet.tsx, workout.tsx）
- [x] NotificationBehavior型エラーを修正（reminder-settings.tsx）
- [x] server/routers.tsの型エラーを修正

## バグ修正54: カレンダーと成分表読み込みのバグ

- [x] カレンダーの当日の丸の色が変わらない問題を修正（今日の日付でもトレーニング記録があればMultiColorDotを表示）
- [x] 成分表の読み込みができない問題を修正（JSONパースエラーハンドリングを強化）

## バグ修正55: expo-barcode-scannerビルドエラー

- [x] expo-barcode-scannerパッケージを削除（未使用のため）

## 実機テストと本番ビルド

- [x] Expo Go実機テスト用QRコード生成（開発サーバーURLで実機テスト可能）
- [ ] iOS実機でのテスト実施
- [ ] Android実機でのテスト実施
- [x] EAS Build設定（eas.json作成）
- [ ] 本番ビルド実施（TestFlight/Google Play内部テスト用）

## ユーザーフィードバック56: アイコン復元とバーコードリーダー修正

- [x] アプリアイコンを元の画像（ピンク背景、緑の葉+フォーク、青いダンベル+力こぶ、オレンジの体重計グラフ）に戻す
- [x] OCR成分表読み取りのJSONパースエラーを修正（プロンプト改善、エラーハンドリング強化）
- [ ] バーコードリーダーの商品取得問題を調査（Open Food Facts APIのデータベースに日本商品が登録されていない可能性）

## ユーザーフィードバック57: アプリ名表示の修正

- [x] アプリ名を「AllFit」に完全変更（app.config.tsのappSlugを"allfit"に、package.jsonのnameを"allfit"に変更）

## ユーザーフィードバック58: 画面タイトルの修正

- [x] 画面上部のタイトルを「OmniTrack Fitness」から「AllFit」に変更（app/(tabs)/index.tsxとshare-workout.tsxを修正）

## ユーザーフィードバック59: TypeScript型エラー修正と本番ビルド

- [x] TypeScript型エラーを確認（開発サーバーのログは古いキャッシュ、実際にはエラーなし）
- [ ] EAS Buildで本番ビルドを実行（ローカル環境でeas build --platform android --profile productionを実行）

## ユーザーフィードバック60: プリセット食事削除機能

- [x] 食事タブのプリセット食事を削除できる機能を追加（長押しで削除、デフォルトプリセットも削除可能）

## ユーザーフィードバック61: OCR成分表読み取りエラー修正

- [x] OCR成分表読み取りのJSONパースエラーを修正（不正文字削除、フォールバックパース、詳細ログ追加、tRPC useMutationフック使用）
- [ ] 実機テストで成分表読み取りが正常に動作することを確認

## ユーザーフィードバック62: アプリアイコン変更

- [x] アプリアイコンを新しい画像（角丸のピンク背景、緑の葉+フォーク、青いダンベル+力こぶ、オレンジの体重計グラフ）に変更

## ユーザーフィードバック63: OCR成分表読み取りの改善

- [x] 成分表の表示から改行コード（\\n）を削除して見やすくする
- [x] OCRスキャン範囲を縦長に変更（280x380に調整）
- [x] 読み込んだ成分表データを編集できる機能を追加（モーダル画面で商品名、分量、カロリー、PFCを編集可能）

## ユーザーフィードバック64: バーコードリーダー改善、マイ食品機能、プリセットリセット機能

- [x] バーコードリーダーのLLM連携機能を実装（Open Food Facts APIで商品が見つからない場合、LLMでバーコード番号から商品情報を推定）
- [x] マイ食品機能を実装（ユーザー独自の食品を登録・編集・削除できる機能）
- [x] プリセット食事のリセット機能を実装（削除したデフォルトプリセットを復元できる「初期値に戻す」ボタンを設定画面に追加）

## ユーザーフィードバック65: 記録タブのレイアウト修正

- [x] 記録タブの保存ボタンが広告バナーと重なる問題を修正（保存ボタンを広告バナーの上に配置、bottom: 50で固定）

## ユーザーフィードバック66: ジオフェンシング登録エラー

- [x] ジオフェンシング設定画面で「保存してジオフェンシングに登録」ボタンを押すと「ジオフェンシングに失敗しました」エラーが表示される問題を修正（Web環境ではジオフェンシングが利用できないことを明示的に通知、エラーメッセージを改善）

## ユーザーフィードバック67: 記録画面のレイアウト修正とAPKインストール問題

- [x] 記録画面のカレンダーで5週目の31日が性別ボタンと重なる問題を修正（カレンダーのmb-6をmb-8に変更、性別セクションのmarginTopを削除）
- [x] APKファイルでAndroidにインストールした際の問題を調査・修正（Androidの位置情報権限を追加、expo-locationプラグインを設定）


## 引き継ぎドキュメント作成（アンチグラビティチーム向け）

- [x] HANDOVER.md - 詳細な引き継ぎドキュメント（プロジェクト概要、技術スタック、セットアップ手順、データ仕様、API連携）
- [x] QUICKSTART.md - 5分でスタート可能なガイド（環境セットアップ、コマンド、主要ファイル、トラブル対応）
- [x] ARCHITECTURE.md - システムアーキテクチャドキュメント（アーキテクチャ図、データフロー、状態管理、パフォーマンス最適化、セキュリティ）
- [x] ENV_SETUP.md - 環境変数設定ガイド（必須・オプション変数、セットアップ手順、トラブルシューティング）
- [x] DEPLOYMENT.md - デプロイメントガイド（Web/iOS/Android版デプロイ、App Store/Google Play登録、ビルド設定）
- [x] HANDOVER_CHECKLIST.md - 引き継ぎチェックリスト（7フェーズ、各フェーズのタスク、トラブルシューティング）

**引き継ぎドキュメント作成完了日:** 2026-02-18
